
<ng-container *ngIf="this.loading">
  <app-x-spinner></app-x-spinner>
</ng-container>

<div class="position-relative">
  <app-feature-header class="summary-header"
  [icon]="'./assets/media/icons/duotune/abstract/abs027.svg'"
  [featureName]="'Summary'"
  ></app-feature-header>
  <div class="content">

    <div class="act-btns" *ngIf="currentCase">
      <ng-container *ngIf=" availableCaseMode && currentCase.caseOffer?.offerStatus !=='REJECTED'" >
        <a class="btn btn-sm me-2 " [ngClass]="{'cursor-na': isSubmitted===true , 'cursor-pointer' : buttonText==='Submit' }"
   [class.btn-light]="!isSubmitted"
   [class.btn-success]="isSubmitted"
   (click)="toggleSubmit($event)"
   >


    <span *ngIf="isSubmitted" class="svg-icon svg-icon-3">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path opacity="0.3" d="M10 18C9.7 18 9.5 17.9 9.3 17.7L2.3 10.7C1.9 10.3 1.9 9.7 2.3 9.3C2.7 8.9 3.29999 8.9 3.69999 9.3L10.7 16.3C11.1 16.7 11.1 17.3 10.7 17.7C10.5 17.9 10.3 18 10 18Z" fill="black" />
        <path d="M10 18C9.7 18 9.5 17.9 9.3 17.7C8.9 17.3 8.9 16.7 9.3 16.3L20.3 5.3C20.7 4.9 21.3 4.9 21.7 5.3C22.1 5.7 22.1 6.30002 21.7 6.70002L10.7 17.7C10.5 17.9 10.3 18 10 18Z" fill="black" />
      </svg>
    </span>

    <span *ngIf="!isProcessing">{{ buttonText }}</span>
    <span *ngIf="isProcessing">Please wait...
        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
    </span>
</a>
       </ng-container>
      <a  (click)="printPage()" class="btn btn-sm btn-primary me-2" *ngIf="currentCase.caseOffer?.offerStatus !== 'REJECTED'">Print</a>
      <span *ngIf="currentCase.caseOffer?.offerStatus === 'REJECTED'"
      class="btn btn-sm bg-danger text-white cursor-na"
      >This offer is rejected</span>
    </div>
      <div class="page"  id="page-print">
        <!-- haeder -->
        <header>
          <div class="header-content pt-2">
              <div class="d-flex justify-content-between flex-column flex-sm-row gap-4">
                <div class="case-title">
                  <div class="d-flex gap-3 align-items-center">
                    <div class="case-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="42" height="37" viewBox="0 0 42 37" fill="none">
                        <g clip-path="url(#clip0_580_852)">
                          <path d="M19.9597 9.26444V24.6279L15.9563 19.8068L0.0852052 0.711462C-0.17124 0.304868 0.241922 -0.15981 0.640836 0.0434867L11.9529 4.21107C11.9529 4.21107 11.9672 4.22559 11.9957 4.22559L17.0961 6.11334C17.3668 6.21499 17.6232 6.33116 17.8796 6.46185C18.1076 6.57802 18.3355 6.72324 18.5492 6.86845C19.5323 7.56546 19.9597 8.30604 19.9597 9.26444Z" fill="url(#paint0_linear_580_852)"/>
                          <path d="M1.13855 36.9856C0.739638 37.0873 0.483193 36.6516 0.739638 36.3467L3.36108 33.5441C5.04222 31.6128 12.3936 23.3502 16.1406 19.2698C18.0069 17.2368 19.9445 15.5233 19.9445 12.0527V28.8247C19.9445 30.1316 19.2607 31.09 17.608 32.0339C17.608 32.0339 17.5795 32.0629 17.5368 32.0629L1.13855 36.9856Z" fill="url(#paint1_linear_580_852)"/>
                          <path d="M19.9594 10.0198L12.893 12.0527L12.1094 15.1748L15.7851 19.6038L15.8136 19.6328C15.9276 19.5166 16.0415 19.3859 16.1413 19.2698C17.6657 17.6144 19.2328 16.1768 19.76 13.8243C19.8882 13.287 19.9452 12.7062 19.9452 12.0527" fill="url(#paint2_linear_580_852)"/>
                          <path d="M22.0547 9.26457V24.628L26.0581 19.807L41.9292 0.72611C42.1856 0.319517 41.7725 -0.145162 41.3735 0.0581351L30.0757 4.2112C30.0757 4.2112 30.0615 4.22572 30.033 4.22572L24.9326 6.11347C24.6619 6.21512 24.4054 6.33129 24.149 6.46198C23.921 6.57815 23.6931 6.72336 23.4794 6.86857C22.4963 7.56559 22.0547 8.30617 22.0547 9.26457Z" fill="url(#paint3_linear_580_852)"/>
                          <path d="M24.4624 32.0775C24.4339 32.0775 24.3912 32.0484 24.3912 32.0484C22.7528 31.1191 22.0547 30.1461 22.0547 28.8392V12.0527C22.0547 15.5233 23.9923 17.2368 25.8586 19.2698C29.6056 23.3502 36.957 31.5983 38.6381 33.5441L41.2596 36.3467C41.516 36.6516 41.2596 37.0873 40.8607 36.9856L24.4624 32.0775Z" fill="url(#paint4_linear_580_852)"/>
                          <path d="M22.0547 10.0198L29.1212 12.0527L29.9048 15.1748L26.2148 19.6038H26.1863C26.0723 19.4876 25.9726 19.3714 25.8586 19.2553C24.3342 17.5998 22.767 16.1622 22.2399 13.8098C22.1117 13.2725 22.0547 12.6917 22.0547 12.0382" fill="url(#paint5_linear_580_852)"/>
                        </g>
                        <defs>
                          <linearGradient id="paint0_linear_580_852" x1="21.312" y1="18.0093" x2="3.68599" y2="-1.35033" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791227" stop-color="#0050BF"/>
                            <stop offset="0.2003" stop-color="#0A67C7"/>
                            <stop offset="0.6002" stop-color="#24A0DB"/>
                            <stop offset="1" stop-color="#41E0F2"/>
                          </linearGradient>
                          <linearGradient id="paint1_linear_580_852" x1="4.70408" y1="33.671" x2="23.7909" y2="18.5926" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791227" stop-color="#0050BF"/>
                            <stop offset="0.2003" stop-color="#0A67C7"/>
                            <stop offset="0.6002" stop-color="#24A0DB"/>
                            <stop offset="1" stop-color="#41E0F2"/>
                          </linearGradient>
                          <linearGradient id="paint2_linear_580_852" x1="19.4323" y1="18.5648" x2="15.7693" y2="12.3895" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791249"/>
                            <stop offset="1" stop-color="#1176CC" stop-opacity="0"/>
                          </linearGradient>
                          <linearGradient id="paint3_linear_580_852" x1="20.698" y1="18.0066" x2="38.324" y2="-1.35299" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791227" stop-color="#0050BF"/>
                            <stop offset="0.2003" stop-color="#0A67C7"/>
                            <stop offset="0.6002" stop-color="#24A0DB"/>
                            <stop offset="1" stop-color="#41E0F2"/>
                          </linearGradient>
                          <linearGradient id="paint4_linear_580_852" x1="37.2955" y1="33.6892" x2="18.2086" y2="18.6108" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791227" stop-color="#0050BF"/>
                            <stop offset="0.2003" stop-color="#0A67C7"/>
                            <stop offset="0.6002" stop-color="#24A0DB"/>
                            <stop offset="1" stop-color="#41E0F2"/>
                          </linearGradient>
                          <linearGradient id="paint5_linear_580_852" x1="22.5781" y1="18.5498" x2="26.2364" y2="12.3825" gradientUnits="userSpaceOnUse">
                            <stop offset="0.00791249"/>
                            <stop offset="1" stop-color="#1176CC" stop-opacity="0"/>
                          </linearGradient>
                          <clipPath id="clip0_580_852">
                            <rect width="42" height="37" fill="white"/>
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                    <div class="case-name">
                      <div class="d-flex justify-content-start flex-column">
                        <div class=" text-hover-primary fw-bold  fs-4">
                         {{currentCase?.name}}
                        </div>
                        <span class="text-muted fw-medium d-block fs-8">{{currentCase?.uuid}}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="case-dates d-flex flex-column " >
                  <div class="d-flex justify-content-between flex-row  gap-10">
                    <div class=" text-hover-primary fs-7 fw-bold  ">
                      Publish Date:
                    </div>
                    <div class="text-muted text-hover-primary fs-7 fw-medium  ">
                      {{currentCase?.startDate}}
                     </div>

                  </div>
                  <div class="d-flex justify-content-between flex-row mt-2 gap-10">
                    <div class=" text-hover-primary fs-7 fw-bold  ">
                      Expiry Date:
                    </div>
                    <div class="text-muted text-hover-primary fs-7 fw-medium ">
                      {{currentCase?.expiryDate}}
                     </div>

                  </div>
                </div>
              </div>
          </div>
        </header>
        <main>
          <div class="case-abstract mt-20">
            <div class="text-gray-800 fs-6 fw-bolder text-uppercase">Case Abstract</div>
            <div class="case-abstract pt-4 justify-text fs-6" [innerHTML]="currentCase?.caseAbstract"></div>
          </div>
          <div class="case-info mt-10">

            <table class="case-info-table">
              <tr>
                <th class="fw-medium">Case Type</th>
                <th class="fw-medium">Research Duration</th>
                <th class="fw-medium">Case Budget</th>
              </tr>
              <tr>
                <td>{{currentCase?.caseType}}</td>
                <td>{{currentCase?.duration}} {{currentCase?.durationType}}</td>
                <td >{{currentCase?.budget}}</td>
              </tr>
            </table>
            <ng-container *ngIf="currentCase?.caseRequirements?.length >0">
              <div class="text-gray-800 fs-6 fw-bolder text-uppercase  pt-10 pb-4">Requirements</div>
              <table class="case-info-table">
                <tr>
                  <th class="fw-medium text-uppercase" style="width: 20%;">  Name</th>
                  <th class="fw-medium text-uppercase" style="width: 70%;">Description</th>
                  <th class="fw-medium text-uppercase" >Attchments</th>
                </tr>
               <ng-container *ngFor="let req of currentCase?.caseRequirements">
                <tr>
                  <td>{{req.name}}</td>
                  <td [innerHTML]="req.description | safeHtml"></td>
                  <td >
                    <a class="cursor-pointer" (click)="downloadFile(req)">  {{req.attachmentName | stringTruncate:10}}</a>
                  </td>
                </tr>
               </ng-container>
              </table>
            </ng-container>



          </div>
          <div class="payment-plan mt-10">
            <div class="text-gray-800 fs-6 fw-bolder text-uppercase">Payment Plan</div>
            <div class="text-primary fw-bolder pt-4  fs-7 text-uppercase"><span class="text-gray-800">Type:</span> {{currentCase?.paymentPlanningMethod}}</div>

            <ng-container *ngIf="currentCase?.paymentPlanningMethod !=='DELIVERABLES' ; else deliverableTemplate">
              <ng-container *ngTemplateOutlet ="monthlyQuarterlyPayment"></ng-container>
            </ng-container>

            <ng-template #deliverableTemplate>
              <ng-container *ngTemplateOutlet ="deliverables"></ng-container>
            </ng-template>

            <ng-template #monthlyQuarterlyPayment>
              <div class="case-info mt-7">
                <table class="case-info-table">
                  <tr>
                    <th class="fw-medium text-uppercase">Payment No</th>
                    <th class="fw-medium text-uppercase"> Percentage</th>
                    <th class="fw-medium text-uppercase">Amount</th>
                  </tr>
                  <tr *ngFor=" let payment of currentCase?.paymentPlanning">
                    <td>{{payment?.paymentNo}}</td>
                    <td> % {{payment?.percentage}} </td>
                    <td >$ {{payment?.amount}}</td>
                  </tr>
                </table>
              </div>

            </ng-template>

            <ng-template #deliverables>
              <div class="case-info mt-7" >
                <table class="case-info-table">
                  <tr>
                    <th class="fw-medium text-uppercase">Deliverable</th>
                    <th class="fw-medium text-uppercase">Amount</th>
                    <th class="fw-medium text-uppercase">description</th>
                  </tr>
                  <tr *ngFor=" let payment of currentCase?.paymentPlanning">
                    <td>{{payment?.name}}</td>
                    <td>${{payment?.amount}}</td>
                    <td > {{payment?.description}}</td>
                  </tr>
                </table>

              </div>

            </ng-template>

          <!-- <div class="delivarble-payment" >
            <label *ngIf="currentCase?.paymentPlanningMethod ==='DELIVERABLES'" class="fs-6 fw-bold mb-2 text-uppercase text-primary mt-10"
            >Payment Timeline
            <i
              class="fas fa-exclamation-circle ms-2 fs-7"
              data-bs-toggle="tooltip"
              title="Select a discount type that will be applied to this product"
            ></i
          ></label>
            <div #timeline id="timeline" class="mt-10"></div>
          </div> -->
          </div>
        </main>
      </div>

     </div>
</div>


